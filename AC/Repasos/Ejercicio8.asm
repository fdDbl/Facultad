EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
ID_TIMER EQU 18
CONT EQU 10H
COMP EQU 11H

ORG 72
DW SUB_TIMER

ORG 1000H
MSJ1 DB "....."
MSJ2 DB "ESCRIBA 5 CARACTERES: "
FIN_MSJ2 DB ?

ORG 3000H
SUB_IMP: MOV BX, SP
ADD BX, 2
MOV BX, [BX]

CLI
  MOV AL, 11111101B
  OUT IMR, AL
  MOV AL, ID_TIMER
  OUT INT1, AL
  MOV AL, 0
  OUT CONT, AL
  INC AL
  OUT COMP, AL
STI

LOOP: CMP BX, OFFSET MSJ2
  JNZ LOOP

MOV AL, 0FFH
OUT IMR, AL
RET

ORG 3100H
SUB_TIMER: MOV AL, 1
INT 7
INC BX
MOV AL, 0
OUT CONT, AL
INC AL
OUT COMP, AL
MOV AL, EOI
OUT EOI, AL

IRET

ORG 2000H
MOV BX, OFFSET MSJ2
MOV AL, OFFSET FIN_MSJ2 - OFFSET MSJ2
INT 7

MOV BX, OFFSET MSJ1
LOOP_ESCRIBIR: INT 6
INC BX
CMP BX, OFFSET MSJ2
JNZ LOOP_ESCRIBIR

MOV BX, OFFSET MSJ1
PUSH BX
CALL SUB_IMP

INT 0
END
