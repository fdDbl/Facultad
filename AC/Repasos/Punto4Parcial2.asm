PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H

EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
ID_INT1 EQU 5
CONT EQU 10H
COMP EQU 11H

ORG 20
DW SUBRUT_TIMER

ORG 1000H
N DB 10,50,40,80,100,10
D DB 2,1,3,4,2,5
DUR DB 1

ORG 3000H
INI_PIO: MOV AL, 0
OUT CA, AL
OUT CB, AL
RET

ORG 3100H
SUBRUT_TIMER: MOV AL, [BX]
OUT PB, AL
SUB BYTE PTR[BX], CL
MOV AL, [BX]
OUT PA, AL
CMP CH, CL
JNZ IRET_SUBRUT

FIN_ALL: MOV AL, 0FFH
OUT IMR, AL
JMP FIN_S

IRET_SUBRUT: ADD BYTE PTR[BX], CL
INC BX
INC CH
MOV AL, 0
OUT CONT, AL
MOV AL, DUR
OUT COMP, AL

FIN_S: MOV AL, EOI
OUT EOI, AL
IRET

ORG 2000H
CALL INI_PIO
MOV CL, OFFSET D - OFFSET N
MOV CH, 0
MOV BX, OFFSET D
CLI
  MOV AL, 11111101B
  OUT IMR, AL
  MOV AL, ID_INT1
  OUT INT1, AL
  MOV AL, 0
  OUT CONT, AL
  MOV AL, DUR
  OUT COMP, AL
STI

MAIN: CMP CH, CL
JNZ MAIN

MOV AL, 0
OUT PB, AL
INT 0
END
