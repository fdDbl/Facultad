EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
IDINT1 EQU 22
CONT EQU 10H
COMP EQU 11H

PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H

ORG 88
DW RUT_TIMER

ORG 1000H
D DB 30,50,5,60,90,60
T DB 150,110,175,200,140,100
DUR_TIMER DB 1
FLAG1 DB 0

ORG 3000H
INI_PIO: MOV AL, 0
OUT CA, AL
OUT CB, AL
RET

ORG 3100H
RUT_TIMER: MOV AL, [BX]
OUT PB, AL
ADD BX, CX
MOV AL, [BX]
OUT PA, AL
INC DX
CMP DX, CX
JNZ SEGUIR
  MOV AL, 0FFH
  OUT IMR, AL
  MOV FLAG1, 1
  JMP FIN_RUT_TIMER
SEGUIR: SUB BX, CX
INC BX
MOV AL, 0
OUT CONT, AL
MOV AL, DUR_TIMER
OUT COMP, AL
FIN_RUT_TIMER:
  MOV AL, EOI
  OUT EOI, AL
  IRET

ORG 2000H
CALL INI_PIO
MOV CX, OFFSET T - OFFSET D
MOV DX, 0
MOV BX, OFFSET D
CLI
  MOV AL, 0
  OUT CONT, AL
  MOV AL, DUR_TIMER
  OUT COMP, AL
  MOV AL, 11111101B
  OUT IMR, AL
  MOV AL, IDINT1
  OUT INT1, AL
STI

MAIN: CMP FLAG1, 0
JZ MAIN

MOV AL, 0
OUT PB, AL

INT 0
END
