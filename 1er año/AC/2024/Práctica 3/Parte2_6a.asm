EOI EQU 20H
IMR EQU 21H
INT0 EQU 24H
INT1 EQU 25H
CONT EQU 10H
COMP EQU 11H

IDINT0 EQU 12
IDINT1 EQU 16

ORG 48
DW SUBRUT_F10

ORG 64
DW SUBRUT_TIMER

ORG 1000H
VALOR DB ?
FIN DB ?

ORG 2000H
CALL LEER_VALOR
CLI
  MOV AL, 11111110B
  OUT IMR, AL
  MOV AL, IDINT0
  OUT INT0, AL
  MOV AL, IDINT1
  OUT INT1, AL
STI
MAIN: CMP FIN, 1
JNZ MAIN
INT 0

ORG 3000H
LEER_VALOR: MOV BX, OFFSET VALOR
INT 6
RET

ORG 3100H
SUBRUT_TIMER: PUSH AX
  PUSH BX
  MOV BX, OFFSET VALOR
  MOV AL, 1
  INT 7
  
  CMP VALOR, 30H
  JNZ SIGUE
    MOV FIN, 1
    MOV AL, 0FFH
    OUT IMR, AL
    
  SIGUE: DEC VALOR
  MOV AL, 0
  OUT CONT, AL
  MOV AL, EOI
  OUT EOI, AL
  POP BX
  POP AX
  IRET

ORG 3200H
SUBRUT_F10: PUSH AX
  PUSH BX
  MOV AL, 11111101B
  OUT IMR, AL
  MOV AL, 0
  OUT CONT, AL
  MOV AL, 1
  OUT COMP, AL
  MOV AL, EOI
  OUT EOI, AL
  POP BX
  POP AX
  IRET
END
